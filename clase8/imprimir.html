<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Factura</title>

    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 13px;
        color: #000;
      }

      .factura {
        max-width: 800px;
        margin: auto;
      }

      h2 {
        margin: 0;
      }

      .encabezado,
      .cliente {
        margin-bottom: 15px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      th,
      td {
        border: 1px solid #000;
        padding: 6px;
      }

      th {
        background: #f2f2f2;
      }

      .text-right {
        text-align: right;
      }

      .total {
        font-size: 16px;
        font-weight: bold;
      }

      @media print {
        button {
          display: none;
        }
      }
    </style>
  </head>

  <body>
    <button onclick="window.print()">Imprimir</button>

    <div class="factura">
      <!-- ENCABEZADO -->
      <div class="encabezado">
        <h2>MI NEGOCIO</h2>
        <div>RNC: 1-01-00000-0</div>
        <div>Fecha: 2026-01-29</div>
        <div>Factura No.: <span id="spNumFactura">###</span></div>
      </div>

      <!-- CLIENTE -->
      <div class="cliente">
        <strong>Cliente:</strong> <span id="spNombreCliente"></span><br />
        <strong>RNC / Cédula:</strong> <span id="spRncCliente"></span>
      </div>

      <!-- DETALLE -->
      <table>
        <thead>
          <tr>
            <th>Código</th>
            <th>Descripción</th>
            <th class="text-right">Precio</th>
            <th class="text-right">Cantidad</th>
            <th class="text-right">Subtotal</th>
          </tr>
        </thead>
        <tbody id="tbDetalleFactura">
         
        </tbody>
      </table>

      <!-- TOTAL -->
      <p class="total text-right">Total: <span id="spTotal">###</span></span></p>

      <p style="text-align: center; margin-top: 30px">Gracias por su compra</p>
    </div>
    <script>
       
         function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
         }

        let indice = getQueryParam('codigo');

        let  tmp = localStorage.getItem('facturas');

         if(tmp == null){
            alert('No hay facturas guardadas');
            throw new Error('No hay facturas guardadas');
         }

        let facturas = JSON.parse( tmp );

        if(indice == null || indice < 0 || indice >= facturas.length){
            alert('Factura no encontrada');
            throw new Error('Factura no encontrada');
        }

        let factura = facturas[indice];

        document.getElementById('spNumFactura').innerText = factura.numeroFactura;
        document.getElementById('spNombreCliente').innerText = factura.nombreCliente;
        document.getElementById('spRncCliente').innerText = factura.rncCliente;
        document.getElementById('spTotal').innerText = factura.total;

        let tbDetalle = document.getElementById('tbDetalleFactura');
        tbDetalle.innerHTML = '';

        for(x=0; x < factura.detalles.length; x++){
            let item = factura.detalles[x];

            let tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${item.codigo}</td>
                <td>${item.descripcion}</td>
                <td class="text-right">${item.precio.toFixed(2)}</td>
                <td class="text-right">${item.cantidad}</td>
                <td class="text-right">${(item.precio * item.cantidad).toFixed(2)}</td>
            `;
            tbDetalle.appendChild(tr);
        }

        window.print();

    </script>
  </body>
</html>
